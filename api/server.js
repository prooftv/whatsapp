import express from 'express';\nimport dotenv from 'dotenv';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\nimport { handleWebhook, verifyWebhook } from '../src/webhook.js';\nimport { healthCheck } from '../src/health.js';\nimport { scheduleNextBroadcasts } from '../src/broadcast.js';\nimport adminRoutes from '../src/admin.js';\n\ndotenv.config();\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nconst app = express();\n\n// Middleware\napp.use(express.json({ limit: '50mb' }));\napp.use(express.urlencoded({ extended: true }));\n\n// Serve PWA static files\napp.use(express.static(path.join(__dirname, '../public')));\n\n// Health check\napp.get('/health', async (req, res) => {\n  const health = await healthCheck();\n  res.json(health);\n});\n\n// Admin API routes\napp.use('/admin', adminRoutes);\n\n// WhatsApp webhook endpoints\napp.get('/webhook', verifyWebhook);\napp.post('/webhook', handleWebhook);\n\n// PWA routes\napp.get('/', (req, res) => {\n  res.sendFile(path.join(__dirname, '../public/index.html'));\n});\n\napp.get('/moments', (req, res) => {\n  res.sendFile(path.join(__dirname, '../public/index.html'));\n});\n\n// Error handling\napp.use((error, req, res, next) => {\n  console.error('Server error:', error);\n  res.status(500).json({ error: 'Internal server error' });\n});\n\n// 404 handler\napp.use((req, res) => {\n  res.status(404).json({ error: 'Not found' });\n});\n\nexport default app;